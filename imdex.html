<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠ â€” ØªØ³Ø¬ÙŠÙ„ ÙˆØ¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</title>

<!-- Bootstrap RTL -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet"/>

<!-- SheetJS (Ø¥Ù† ÙƒÙ†Øª ØªØµØ¯Ù‘Ø± Excel/JSON Ù„Ø§Ø­Ù‚Ø§Ù‹) -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
:root{ --brand:#0d47a1; --muted:#6c757d; }
body{ background:#fff; color:#222; }
.navbar{ background:var(--brand); }
.navbar .navbar-brand,.navbar .btn,.navbar .nav-link{ color:#fff; }
.navbar .btn.btn-light{ color:var(--brand); }
.card{ box-shadow:0 2px 10px rgba(0,0,0,.05); border:1px solid #eef1f4; }
.badge-soft{background:#eef2ff;color:#2b3a67;border:1px solid #dfe7ff}
.pill{padding:.35rem .6rem;border-radius:1rem;border:1px solid #e5e8ee;background:#fff}
.muted{ color:var(--muted); }

#auth-view{ max-width:420px; margin:7vh auto; }
.auth-logo{ font-size:2rem; color:var(--brand); }
.auth-hint{ font-size:.9rem; color:#6b7280; }
.link{ cursor:pointer; color:#0d6efd; text-decoration:underline; }

@media (max-width: 576px){
  .navbar-brand{ font-size:1rem; }
}
</style>
</head>
<body>

<!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ -->
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#">ğŸ“Š Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠ</a>
    <div class="ms-auto d-flex align-items-center gap-2">
      <div class="btn-group" role="group" aria-label="lang">
        <button id="btn-ar" class="btn btn-light btn-sm">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        <button id="btn-en" class="btn btn-outline-light btn-sm">English</button>
      </div>
      <button id="btn-signout" class="btn btn-light btn-sm d-none">ğŸšª <span data-i18n="signout">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span></button>
    </div>
  </div>
</nav>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<section id="auth-view" class="container">
  <div class="card">
    <div class="card-body p-4">
      <div class="text-center mb-3">
        <div class="auth-logo">ğŸ”</div>
        <h5 class="mt-2" data-i18n="signinTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h5>
        <div class="auth-hint" data-i18n="signinHint">Ø§Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</div>
      </div>

      <div class="vstack gap-2">
        <label class="form-label" data-i18n="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input id="auth-email" type="email" class="form-control" placeholder="name@example.com" autocomplete="username" />
        <label class="form-label mt-2" data-i18n="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input id="auth-pass" type="password" class="form-control" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />
      </div>

      <div class="d-grid gap-2 mt-3">
        <button id="btn-login" class="btn btn-primary"><span data-i18n="signinBtn">Ø¯Ø®ÙˆÙ„</span></button>
        <button id="btn-register" class="btn btn-outline-primary"><span data-i18n="signupBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span></button>
      </div>

      <div id="auth-error" class="text-danger small mt-3" style="display:none"></div>

      <div class="text-center mt-3">
        <span class="auth-hint" data-i18n="firstTime">
          Ø£ÙˆÙ„ Ù…Ø±Ø© ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ø­Ø§Ø¨Ø©ØŸ Ø§Ø¶ØºØ· â€œØ¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯â€ØŒ Ø«Ù… Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„.
        </span>
      </div>
    </div>
  </div>
</section>

<!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<section id="app-view" class="container-fluid" style="display:none">
  <div class="row g-3 p-3">
    <div class="col-12 d-flex align-items-center gap-2 flex-wrap">
      <span class="pill"><span class="muted" data-i18n="state">Ø§Ù„Ø­Ø§Ù„Ø©</span>:
        <b id="login-state" class="text-success">â€”</b>
      </span>
      <span class="pill"><span class="muted" data-i18n="user">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>:
        <b id="login-user">â€”</b>
      </span>
      <div class="ms-auto d-flex gap-2">
        <button class="btn btn-outline-success btn-sm" id="btn-save-cloud">â˜ï¸ <span data-i18n="saveCloud">Ø­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠ</span></button>
        <button class="btn btn-outline-secondary btn-sm" id="btn-load-cloud">â˜ï¸ <span data-i18n="loadCloud">ØªØ­Ù…ÙŠÙ„ Ø³Ø­Ø§Ø¨ÙŠ</span></button>
      </div>
    </div>

    <!-- Ø¶Ø¹ Ø¨Ø±Ù†Ø§Ù…Ø¬Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ Ù‡Ù†Ø§ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± -->
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex align-items-center justify-content-between">
          <span>ğŸ“’ <b data-i18n="yourApp">Ø¨Ø±Ù†Ø§Ù…Ø¬Ùƒ</b></span>
          <span class="text-muted small" data-i18n="yourAppHint">Ø¶Ø¹ Ù‡Ù†Ø§ ÙƒÙˆØ¯ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„/Ø§Ù„Ø£Ù‚Ø³Ø§Ù…/Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øªâ€¦)</span>
        </div>
        <div class="card-body" id="your-app">
          <!-- â¬…ï¸â¬…ï¸â¬…ï¸  Ø§Ù„ØµÙ‚ Ù‡Ù†Ø§ ÙˆØ§Ø¬Ù‡ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ù„ØªÙŠ ØªØµÙ„ ~1000 Ø³Ø·Ø±)  â¬…ï¸â¬…ï¸â¬…ï¸
               Ù„Ù† ØªØ­ØªØ§Ø¬ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£ÙŠ Ø´ÙŠØ¡ Ø¨Ø¯Ø§Ø®Ù„Ù‡Ø§. ÙÙ‚Ø· ØªØ£ÙƒØ¯ Ø£Ù† Ù„Ø¯ÙŠÙƒ ÙƒØ§Ø¦Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ DB
               Ø£Ùˆ ØºÙŠÙ‘Ø± Ø§Ù„Ø¯ÙˆØ§Ù„ saveLocal()/renderPage() Ø£Ø¯Ù†Ø§Ù‡ Ù„ØªÙ†Ø§Ø³Ø¨Ùƒ. -->
          <div class="alert alert-info m-0">
            <div data-i18n="placeholder">
              Ù‡Ø°Ù‡ Ù…Ø¬Ø±Ø¯ Ù…Ø³Ø§Ø­Ø© Ù…Ø¤Ù‚ØªØ© Ù„Ù„Ø´Ø±Ø­. Ø§Ù„ØµÙ‚ ÙˆØ§Ø¬Ù‡ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù‡Ù†Ø§ Ù„ÙŠØ¹Ù…Ù„ ÙƒÙ„ Ø´ÙŠØ¡ ÙƒÙ…Ø§ ÙƒØ§Ù†ØŒ
              Ù„ÙƒÙ† Ù…Ø¹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù…Ù† ÙˆØ­ÙØ¸/ØªØ­Ù…ÙŠÙ„ Ø³Ø­Ø§Ø¨ÙŠ Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù….
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // âœ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´Ø±ÙˆØ¹Ùƒ (Ù†ÙØ³ Ø§Ù„Ø°ÙŠ Ø§Ø³ØªØ®Ø¯Ù…ØªÙ‡ Ù…Ù† Ù‚Ø¨Ù„)
  const firebaseConfig = {
    apiKey: "AIzaSyDgtifnouF0AGzBxWls3wPk7gikSqOBFm0",
    authDomain: "monthly-prfits.firebaseapp.com",
    projectId: "monthly-prfits",
    storageBucket: "monthly-prfits.firebasestorage.app",
    messagingSenderId: "896730662080",
    appId: "1:896730662080:web:a41850c6736ab6b02d1925",
    measurementId: "G-KX9KFLVV3J"
  };

  // âœ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  // ----------------- i18n Ø¨Ø³ÙŠØ· (Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ) -----------------
  const I18N = {
    ar: {
      signout:"ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",
      signinTitle:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
      signinHint:"Ø§Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.",
      email:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
      password:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
      signinBtn:"Ø¯Ø®ÙˆÙ„",
      signupBtn:"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯",
      firstTime:"Ø£ÙˆÙ„ Ù…Ø±Ø© ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ø­Ø§Ø¨Ø©ØŸ Ø§Ø¶ØºØ· â€œØ¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯â€ØŒ Ø«Ù… Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„.",
      state:"Ø§Ù„Ø­Ø§Ù„Ø©",
      user:"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
      saveCloud:"Ø­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠ",
      loadCloud:"ØªØ­Ù…ÙŠÙ„ Ø³Ø­Ø§Ø¨ÙŠ",
      yourApp:"Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©",
      yourAppHint:"Ø¶Ø¹ Ù‡Ù†Ø§ ÙƒÙˆØ¯ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„/Ø§Ù„Ø£Ù‚Ø³Ø§Ù…/Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øªâ€¦)",
      placeholder:"Ù‡Ø°Ù‡ Ù…Ø¬Ø±Ø¯ Ù…Ø³Ø§Ø­Ø© Ù…Ø¤Ù‚ØªØ© Ù„Ù„Ø´Ø±Ø­. Ø§Ù„ØµÙ‚ ÙˆØ§Ø¬Ù‡ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù‡Ù†Ø§ Ù„ÙŠØ¹Ù…Ù„ ÙƒÙ„ Ø´ÙŠØ¡ ÙƒÙ…Ø§ ÙƒØ§Ù†ØŒ Ù„ÙƒÙ† Ù…Ø¹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù…Ù† ÙˆØ­ÙØ¸/ØªØ­Ù…ÙŠÙ„ Ø³Ø­Ø§Ø¨ÙŠ Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù….",
      signedIn:"Ù…ØªØµÙ„",
      signedOut:"ØºÙŠØ± Ù…ØªØµÙ„",
      savedOk:"âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©",
      savedErr:"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©",
      loadedOk:"âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©",
      loadedEmpty:"âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø­Ø§Ø¨ÙŠØ© Ø¨Ø¹Ø¯",
      loadedErr:"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
    },
    en: {
      signout:"Sign out",
      signinTitle:"Sign in",
      signinHint:"Enter your email and password to continue.",
      email:"Email",
      password:"Password",
      signinBtn:"Sign in",
      signupBtn:"Create new account",
      firstTime:"First time? Click â€œCreate new accountâ€, then sign in.",
      state:"Status",
      user:"User",
      saveCloud:"Save to Cloud",
      loadCloud:"Load from Cloud",
      yourApp:"Your App",
      yourAppHint:"Paste your existing UI here (tables/sections/calculationsâ€¦)",
      placeholder:"Temporary placeholder. Paste your existing UI so everything works as before, with secure login and per-user cloud storage.",
      signedIn:"Online",
      signedOut:"Offline",
      savedOk:"âœ… Saved to cloud",
      savedErr:"âŒ Cloud save failed",
      loadedOk:"âœ… Loaded from cloud",
      loadedEmpty:"âš ï¸ No cloud data yet",
      loadedErr:"âŒ Cloud load failed",
    }
  };
  let LANG = 'ar';
  function t(k){ return (I18N[LANG]||{})[k] || k; }
  function applyLang(){
    document.documentElement.lang = LANG;
    document.documentElement.dir = LANG==='ar'?'rtl':'ltr';
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      el.textContent = t(key);
    });
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù†ØµÙŠØ©
    document.getElementById('login-state').textContent =
      auth.currentUser ? t('signedIn') : t('signedOut');
  }
  document.getElementById('btn-ar').onclick=()=>{
    LANG='ar';
    document.getElementById('btn-ar').className='btn btn-light btn-sm';
    document.getElementById('btn-en').className='btn btn-outline-light btn-sm';
    applyLang();
  };
  document.getElementById('btn-en').onclick=()=>{
    LANG='en';
    document.getElementById('btn-en').className='btn btn-light btn-sm';
    document.getElementById('btn-ar').className='btn btn-outline-light btn-sm';
    applyLang();
  };

  // ----------------- Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ù…Ø­Ù„ÙŠØ© (DB) -----------------
  // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ù† ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ ÙƒØ§Ø¦Ù† DB Ø¬Ø§Ù‡Ø² ÙÙŠ ÙˆØ§Ø¬Ù‡ØªÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©ØŒ Ø§ØªØ±ÙƒÙ‡ ÙƒÙ…Ø§ Ù‡Ùˆ.
  // Ù‡Ù†Ø§ Ù†Ø¶Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¨Ø³ÙŠØ· Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø­ÙØ¸/Ø§Ù„ØªØ­Ù…ÙŠÙ„:
  const STORE_KEY = "profit_manager_v3";
  function loadLocal(){
    try{ return JSON.parse(localStorage.getItem(STORE_KEY) || "{}"); }
    catch{ return {}; }
  }
  function saveLocal(obj){
    localStorage.setItem(STORE_KEY, JSON.stringify(obj||DB));
  }
  // Ø¥Ù† ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ DB Ø³Ø§Ø¨Ù‚ ÙØ§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§:
  let DB = loadLocal();

  // ----------------- Firestore (Ø­ÙØ¸/ØªØ­Ù…ÙŠÙ„ Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…) -----------------
  async function saveToCloud(){
    if(!auth.currentUser){ alert(t('savedErr')); return; }
    try{
      const payload = { content: JSON.stringify(DB), updatedAt: new Date().toISOString() };
      const ref = doc(db, "users", auth.currentUser.uid, "profits", "main");
      await setDoc(ref, payload, { merge:true });
      alert(t('savedOk'));
    }catch(e){
      console.error(e); alert(t('savedErr'));
    }
  }
  async function loadFromCloud(){
    if(!auth.currentUser){ alert(t('loadedErr')); return; }
    try{
      const ref = doc(db, "users", auth.currentUser.uid, "profits", "main");
      const snap = await getDoc(ref);
      if(snap.exists()){
        const raw = snap.data().content;
        DB = JSON.parse(raw||"{}");
        saveLocal(DB);
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø¯ÙŠÙƒ Ø¯Ø§Ù„Ø© renderPage() ÙÙŠ ÙˆØ§Ø¬Ù‡ØªÙƒØŒ Ø§Ø³ØªØ¯Ø¹Ù‡Ø§:
        if(typeof window.renderPage === 'function') window.renderPage();
        alert(t('loadedOk'));
      }else{
        alert(t('loadedEmpty'));
      }
    }catch(e){
      console.error(e); alert(t('loadedErr'));
    }
  }

  // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  document.getElementById('btn-save-cloud').onclick=saveToCloud;
  document.getElementById('btn-load-cloud').onclick=loadFromCloud;

  // ----------------- Auth: ØªØ³Ø¬ÙŠÙ„/Ø¯Ø®ÙˆÙ„/Ø®Ø±ÙˆØ¬ -----------------
  const $email = document.getElementById('auth-email');
  const $pass  = document.getElementById('auth-pass');
  const $err   = document.getElementById('auth-error');

  async function doLogin(){
    $err.style.display='none';
    try{
      await signInWithEmailAndPassword(auth, $email.value.trim(), $pass.value);
    }catch(e){
      console.error(e);
      $err.textContent = (LANG==='ar'?'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ':'Sign-in failed: ') + (e.message||e.code||'');
      $err.style.display='block';
    }
  }
  async function doRegister(){
    $err.style.display='none';
    try{
      await createUserWithEmailAndPassword(auth, $email.value.trim(), $pass.value);
      // Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ØŒ ÙŠØµØ¨Ø­ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    }catch(e){
      console.error(e);
      $err.textContent = (LANG==='ar'?'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: ':'Sign-up failed: ') + (e.message||e.code||'');
      $err.style.display='block';
    }
  }
  async function doSignout(){
    await signOut(auth);
  }

  document.getElementById('btn-login').onclick=doLogin;
  document.getElementById('btn-register').onclick=doRegister;
  document.getElementById('btn-signout').onclick=doSignout;

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
  onAuthStateChanged(auth, (user)=>{
    const aut = document.getElementById('auth-view');
    const appV= document.getElementById('app-view');
    const signBtn = document.getElementById('btn-signout');
    const uLbl = document.getElementById('login-user');
    const st  = document.getElementById('login-state');

    if(user){
      aut.style.display='none';
      appV.style.display='';
      signBtn.classList.remove('d-none');
      uLbl.textContent = user.email||user.uid;
      st.textContent = t('signedIn');
      st.classList.remove('text-danger'); st.classList.add('text-success');

      // Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ø³Ø­Ø§Ø¨ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):
      // loadFromCloud();

      // Ù„Ùˆ Ù„Ø¯ÙŠÙƒ ÙˆØ§Ø¬Ù‡Ø© Ù‚Ø¯ÙŠÙ…Ø© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ init/render:
      if(typeof window.renderPage === 'function') window.renderPage();

    }else{
      aut.style.display='';
      appV.style.display='none';
      signBtn.classList.add('d-none');
      uLbl.textContent = 'â€”';
      st.textContent = t('signedOut');
      st.classList.add('text-danger'); st.classList.remove('text-success');
    }
  });

  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  (function init(){
    LANG='ar';
    applyLang();
  })();
</script>

<!-- Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø© Ù„Ù„Ø£Ù…Ø§Ù† (Ø¶Ø¹Ù‡Ø§ ÙÙŠ Ù‚ÙˆØ§Ø¹Ø¯ Firestore): 
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{uid}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == uid;
    }
  }
}
-->

</body>
</html>
