<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>برنامج الأرباح الشهري</title>

<!-- Bootstrap RTL -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<!-- SheetJS -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
  body{background:#fff;color:#222}
  .navbar{background:#0d47a1}
  .navbar .navbar-brand,.navbar .btn,.navbar .nav-link{color:#fff}
  .navbar .btn.btn-light{color:#0d47a1}
  .sidebar{min-height:100vh;background:#f1f3f5;border-left:1px solid #e1e5ea}
  .sidebar .list-group-item{border:none;background:transparent}
  .sidebar .list-group-item.active{background:#0d47a1;color:#fff;border-radius:.5rem}
  .card{box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #e9ecef}
  .table td input[type="text"], .table td input[type="number"]{width:100%;border:none;background:transparent}
  .table td input:focus{outline:none;border-bottom:1px solid #0d6efd}
  .muted{color:#6c757d}
  .profit-pos{color:#198754;font-weight:700}
  .profit-neg{color:#dc3545;font-weight:700}
  .section-title{font-weight:700}
  @media print{
    .no-print{display:none!important}
    .sidebar{display:none}
    .container-fluid{padding:0}
    main{width:100%}
    .card{box-shadow:none}
  }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">📊 برنامج الأرباح الشهري</a>
    <div class="ms-auto d-flex gap-2">
      <input type="file" id="importFile" class="d-none" accept=".json" />
      <button class="btn btn-light btn-sm no-print" onclick="document.getElementById('importFile').click()">📥 استيراد بيانات</button>
      <button class="btn btn-light btn-sm no-print" onclick="exportJSON()">📤 تصدير JSON</button>
      <button class="btn btn-light btn-sm no-print" onclick="exportExcel()">📊 تصدير Excel</button>
      <button class="btn btn-light btn-sm no-print" onclick="saveToCloud(DB)">☁️ حفظ سحابي</button>
      <button class="btn btn-light btn-sm no-print" onclick="loadFromCloudBtn()">☁️ تحميل سحابي</button>
      <button class="btn btn-light btn-sm no-print" onclick="window.print()">🖨️ طباعة</button>
    </div>
  </div>
</nav>

<!-- باقي البرنامج هنا (sidebar + main + الجداول + الملخص) -->
<!-- ---------------------- -->
<div class="container-fluid">
  <!-- … (نفس الكود السابق للفروع والجداول) … -->
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase + Firestore -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // إعدادات مشروعك من Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDgtifnouF0AGzBxWls3wPk7gikSqOBFm0",
    authDomain: "monthly-prfits.firebaseapp.com",
    projectId: "monthly-prfits",
    storageBucket: "monthly-prfits.firebasestorage.app",
    messagingSenderId: "896730662080",
    appId: "1:896730662080:web:a41850c6736ab6b02d1925",
    measurementId: "G-KX9KFLVV3J"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // 🔹 دوال الحفظ السحابي
  async function saveToCloud(data) {
    try {
      await setDoc(doc(db, "profits", "main"), { content: JSON.stringify(data) });
      alert("✅ تم الحفظ في السحابة");
    } catch (e) {
      console.error(e);
      alert("❌ خطأ في الحفظ بالسحابة");
    }
  }

  async function loadFromCloudBtn() {
    try {
      const snap = await getDoc(doc(db, "profits", "main"));
      if (snap.exists()) {
        DB = JSON.parse(snap.data().content);
        save(); // إعادة الحفظ محليًا
        renderBranches(); renderPage();
        alert("✅ تم التحميل من السحابة");
      } else {
        alert("⚠️ لا توجد بيانات في السحابة");
      }
    } catch (e) {
      console.error(e);
      alert("❌ خطأ في تحميل البيانات");
    }
  }
</script>

<!-- سكربت البرنامج الأساسي (DB, render, tables, summary …) -->
<script>
/* هنا ضع كل كود البرنامج السابق (DB, renderBranches, renderPage, إلخ)
   كما أرسلته لي من قبل، بدون تغيير.
   فقط الآن صار عندك أزرار الحفظ والتحميل للسحابة. */
</script>

</body>
</html>
