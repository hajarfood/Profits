<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠ</title>

<!-- Bootstrap RTL -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<!-- SheetJS -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
  body{background:#fff;color:#222}
  .navbar{background:#0d47a1}
  .navbar .navbar-brand,.navbar .btn,.navbar .nav-link{color:#fff}
  .navbar .btn.btn-light{color:#0d47a1}
  .sidebar{min-height:100vh;background:#f1f3f5;border-left:1px solid #e1e5ea}
  .sidebar .list-group-item{border:none;background:transparent}
  .sidebar .list-group-item.active{background:#0d47a1;color:#fff;border-radius:.5rem}
  .card{box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #e9ecef}
  .table td input[type="text"], .table td input[type="number"]{width:100%;border:none;background:transparent}
  .table td input:focus{outline:none;border-bottom:1px solid #0d6efd}
  .muted{color:#6c757d}
  .profit-pos{color:#198754;font-weight:700}
  .profit-neg{color:#dc3545;font-weight:700}
  .section-title{font-weight:700}
  @media print{
    .no-print{display:none!important}
    .sidebar{display:none}
    .container-fluid{padding:0}
    main{width:100%}
    .card{box-shadow:none}
  }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">ğŸ“Š Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠ</a>
    <div class="ms-auto d-flex gap-2">
      <input type="file" id="importFile" class="d-none" accept=".json" />
      <button class="btn btn-light btn-sm no-print" onclick="document.getElementById('importFile').click()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</button>
      <button class="btn btn-light btn-sm no-print" onclick="exportJSON()">ğŸ“¤ ØªØµØ¯ÙŠØ± JSON</button>
      <button class="btn btn-light btn-sm no-print" onclick="exportExcel()">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
      <button class="btn btn-light btn-sm no-print" onclick="saveToCloud(DB)">â˜ï¸ Ø­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠ</button>
      <button class="btn btn-light btn-sm no-print" onclick="loadFromCloudBtn()">â˜ï¸ ØªØ­Ù…ÙŠÙ„ Ø³Ø­Ø§Ø¨ÙŠ</button>
      <button class="btn btn-light btn-sm no-print" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>
  </div>
</nav>

<!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù‡Ù†Ø§ (sidebar + main + Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ + Ø§Ù„Ù…Ù„Ø®Øµ) -->
<!-- ---------------------- -->
<div class="container-fluid">
  <!-- â€¦ (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù„ÙØ±ÙˆØ¹ ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„) â€¦ -->
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase + Firestore -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù…Ù† Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDgtifnouF0AGzBxWls3wPk7gikSqOBFm0",
    authDomain: "monthly-prfits.firebaseapp.com",
    projectId: "monthly-prfits",
    storageBucket: "monthly-prfits.firebasestorage.app",
    messagingSenderId: "896730662080",
    appId: "1:896730662080:web:a41850c6736ab6b02d1925",
    measurementId: "G-KX9KFLVV3J"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ğŸ”¹ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ
  async function saveToCloud(data) {
    try {
      await setDoc(doc(db, "profits", "main"), { content: JSON.stringify(data) });
      alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©");
    } catch (e) {
      console.error(e);
      alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©");
    }
  }

  async function loadFromCloudBtn() {
    try {
      const snap = await getDoc(doc(db, "profits", "main"));
      if (snap.exists()) {
        DB = JSON.parse(snap.data().content);
        save(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§
        renderBranches(); renderPage();
        alert("âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©");
      } else {
        alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©");
      }
    } catch (e) {
      console.error(e);
      alert("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    }
  }
</script>

<!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (DB, render, tables, summary â€¦) -->
<script>
/* Ù‡Ù†Ø§ Ø¶Ø¹ ÙƒÙ„ ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø³Ø§Ø¨Ù‚ (DB, renderBranches, renderPage, Ø¥Ù„Ø®)
   ÙƒÙ…Ø§ Ø£Ø±Ø³Ù„ØªÙ‡ Ù„ÙŠ Ù…Ù† Ù‚Ø¨Ù„ØŒ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±.
   ÙÙ‚Ø· Ø§Ù„Ø¢Ù† ØµØ§Ø± Ø¹Ù†Ø¯Ùƒ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„Ø³Ø­Ø§Ø¨Ø©. */
</script>

</body>
</html>
